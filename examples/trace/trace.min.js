(function(){function each(a,b,c){var d,e=0,f=a.length,g=void 0===f||Array.prototype.toString.call(a)===["[object Function]"];if(c)if(g){for(d in a)if(b.apply(a[d],c)===!1)break}else for(;e<f&&b.apply(a[e++],c)!==!1;);else if(g){for(d in a)if(b.call(a[d],d,a[d])===!1)break}else for(;e<f&&b.call(a[e],e,a[e++])!==!1;);return a}function isObject(a){var b=typeof a;return"function"===b||"object"===b&&!!a}function has(a,b){return null!==a&&hasOwnProperty.call(a,b)}function keys(a){if(!isObject(a))return[];if(nativeKeys)return nativeKeys(a);var b=[];for(var c in a)has(a,c)&&b.push(c);return b}function values(a){for(var b=b(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d}function extend(){for(var a=0,b={};a<arguments.length;a++){var c=arguments[a];for(var d in c)b[d]=c[d]}return b}function unique(a){var c,b=[];for(c=0;c<a.length;c++)b.indexOf(a[c])===-1&&b.push(a[c]);return b}function obj2url(a){var b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=encodeURIComponent(c),e="string"!=typeof a[c]?JSON.stringify(a[c]):encodeURIComponent(a[c]);b.push(d+"="+e)}return b.join("&")}function trim(a){return a.replace(/^\s+|\s+$/g,"")}function timesamp(){return+new Date}function getReferrer(){var a="";try{a=root.top.document.referrer}catch(b){if(root.parent)try{a=root.parent.document.referrer}catch(b){a=""}}return""===a&&(a=doc.referrer),a}function detectLevel(a,b,c){var d=[!1,!1,function(){getElePro(b,c)},function(){var a=c.target||c.srcElement;"password"!==a.type&&getElePro(b,c)},function(){"click"!==b&&"mouseup"!==b||getElePro(b,c)}];d[a]&&d[a]()}function send(){each(["record","nextUrl","scriptError"],function(a,b){var c=userAction[b];10===c.length&&(c.length=0)}),userAction.duration=0}function fillEle(a,b){var c={};return c.eventType=b,each(dictionary,function(b,d){var e=a[d];void 0!==e&&""!==e&&(c[d]=e.toLowerCase())}),c}function CompareEle(a,b){var c=!0,d=a.type,e=dictionary;return"checkbox"!==d&&"radio"!==d||(e=dictionary.filter(filterKey)),each(e,function(d,e){var f=a[e];if(void 0!==f&&""!==f&&f!==b[e])return c=!1,!1}),c}function filterKey(a){return"id"!==a&&"className"!==a}function extensionField(){if("undefined"==typeof T_fields)return"";try{JSON.parse(T_fields)}catch(a){return""}return"&extension="+T_fields}function clickFilter(){var a=timesamp();return!(a-config.clickTime<config.clickDiff)}function getElePro(a,b){var c=getElePro[a](b);if(keys(c).length>0){var d=root.userAction.record;d.push(c),10===d.length&&send()}}function getSelectValues(a){for(var d,b=[],c=a&&a.options,e=0,f=c.length;e<f;e++)d=c[e],d.selected&&b.push(d.value||d.text);return b}function getCheckboxValues(a){var b,c=getElementsByName(a.nodeName,a.name);return c.length>1?(b=[],each(c,function(a,c){c.checked&&b.push(c.value)})):b=a.checked?a.value:"",b}function getElementsByName(a,b){var c=document.getElementsByName(b);if(c.length>0)return c;c=[];for(var d=document.getElementsByTagName(a),e=0;e<d.length;e++)d[e].getAttribute("name")==b&&(c[c.length]=d[e]);return c}(function(){this.JSON||(this.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(){var a=Object.prototype.toString,b=Array.isArray||function(b){return"[object Array]"===a.call(b)},c={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},d=function(a){return c[a]||"\\u"+(a.charCodeAt(0)+65536).toString(16).substr(1)},e=/[\\"\u0000-\u001F\u2028\u2029]/g;return function c(f){if(null===f)return"null";if("number"==typeof f)return isFinite(f)?f.toString():"null";if("boolean"==typeof f)return f.toString();if("object"==typeof f){if("function"==typeof f.toJSON)return c(f.toJSON());if(b(f)){for(var g="[",h=0;h<f.length;h++)g+=(h?", ":"")+c(f[h]);return g+"]"}if("[object Object]"===a.call(f)){var i=[];for(var j in f)f.hasOwnProperty(j)&&i.push(c(j)+": "+c(f[j]));return"{"+i.join(", ")+"}"}}return'"'+f.toString().replace(e,d)+'"'}}()})}).call(this),function(a){a.psb=function(){var a={},b=a.hasOwnProperty;return{sub:function(c,d){b.call(a,c)||(a[c]=[]);var e=a[c].push(d)-1;return{remove:function(){delete a[c][e]}}},pub:function(c,d){b.call(a,c)&&each(a[c],function(a,b){b(void 0!==d?d:{})})}}}()}(this);var root=this,doc=document,nav=root.navigator,screen=root.screen,ArrayProto=Array.prototype,push=ArrayProto.push,slice=ArrayProto.slice,ObjProto=Object.prototype,hasOwnProperty=ObjProto.hasOwnProperty,encode=root.encodeURIComponent,decode=root.decodeURIComponent,nativeKeys=Object.keys,JSON=root.JSON,cookie={get:function(a){return decode(doc.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encode(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=s*([^;]*).*$)|^.*$"),"$1"))||r},set:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=c===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return doc.cookie=encode(a)+"="+encode(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},remove:function(a,b,c){return!(!a||!this.hasItem(a))&&(doc.cookie=encode(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0)},has:function(a){return new RegExp("(?:^|;\\s*)"+encode(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(doc.cookie)},keys:function(){for(var a=doc.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=0;b<a.length;b++)a[b]=decode(a[b]);return a}},eventUtils={on:function(a,b,c){for(var d=b.split(" "),e=0,f=d.length;e<f;e++)this.bind(a,d[e],c)},bind:function(a,b,c){return doc.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:doc.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(a,b,c){a["on"+b]=c}}(),off:function(a,b,c){return doc.removeEventListener?function(a,b,c){a.removeEventListener(b,c)}:doc.attachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:function(a,c){a["on"+b]=r}}()},domReady=function(){return doc.addEventListener?function(a,b){eventUtils.on(a,"DOMContentLoaded",b)}:doc.attachEvent?function(a,b){eventUtils.on(a,"readystatechange",function(){"complete"===a.readyState&&b()})}:void 0}(),getSelectText=function(){return root.getSelection?function(){return trim(root.getSelection()+"").slice(0,60)}:function(){return trim(doc.selection.createRange().text).slice(0,60)}}(),getMeta=function(){var d,a=doc.getElementsByTagName("meta"),b=doc.getElementsByTagName("title"),c={keyword:"",description:""};c.title=b&&encode(trim(b[0].innerHTML))||"";for(d in a)"keywords".indexOf(d.toLowerCase())!==-1&&(c.keyword=encode(a[d].content)),"description".indexOf(d.toLowerCase())!==-1&&(c.description=encode(a[d].content));return c}(),navType=function(){var g,a=nav.userAgent,b=/(Maxthon|UBrowser|BIDUBrowser|QQBrowser|LBBROWSER(?=\/))\/?\s*(\d+)/i,d=/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i,e=a.match(b)||a.match(d)||[],f=/Mobile/.test(a);return/trident/i.test(e[1])?(g=/\brv[ :]+(\d+)/g.exec(a)||[],"IE "+(g[1]||"")):"Chrome"===e[1]&&(g=a.match(/\b(OPR|Edge)\/(\d+)/),null!==g)?g.slice(1).join(" ").replace("OPR","Opera"):(e=e[2]?[e[1],e[2]]:[nav.appName,nav.appVersion,"-?"],null!==(g=a.match(/version\/(\d+)/i))&&e.splice(1,1,g[1]),f&&e.push("mobile"),e.join(" "))}(),img=new Image,dictionary=["nodeName","id","className","text","name","type","title","href","src","alt"],scriptSource=function(a){var b=document.getElementsByTagName("script"),c=b[b.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src",-1)}();!function(){function f(){userAction.duration+=d-c,e=!1,clearInterval(g)}var a=timesamp(),b=3e4,c=a,d=a,e=!0,g=setInterval(f,b);setInterval(function(){e||(c=d=timesamp())},1e3),eventUtils.on(doc,"mousemove keydown scroll",function(a){var h=timesamp();clearInterval(g),g=setInterval(f,b),e||(e=!0,c=h),d=h}),psb.sub("visitTime",function(){userAction.duration+=timesamp()-c})}(root);var config={url:"./xx.png?",production:!1,clickDiff:500,clickTime:timesamp(),level:3};root.userAction={visitDepth:0,duration:0,resolution:screen.width+"*"+screen.height,os:navigator.platform,browser:navType,language:nav.language||nav.browserLanguage,currentUrl:encode(location.href),prevUrl:getReferrer(),title:getMeta.title,keyword:getMeta.keyword,description:getMeta.description,connectionType:function(){var a=navigator.connection||navigator.mozConnection||navigator.webkitConnection||navigator.oConnection,b=navType.indexOf("mobile")>-1&&a?a.type:"unknow";return b}()},root.userAction.record=[],root.userAction.scriptError=[],root.userAction.nextUrl=[],eventUtils.on(doc,"click",function(a){var b=a.target||a.srcElement,c="",d=/^javascript.*$|^#.*$/gi,e=null;"A"!==b.nodeName||d.test(c)?(each([1,2,3,4],function(){var a=e||b,c=a.parentNode.nodeName;return e=a.parentNode,"BODY"!==c&&"HTML"!==c&&"A"!==e.nodeName}),c="A"===e.nodeName?e.getAttribute("href"):""):c=b.href?b.getAttribute("href"):"#",c&&!d.test(c)&&userAction.nextUrl.push(c),userAction.nextUrl=unique(userAction.nextUrl)}),eventUtils.on(doc,"click keyup change mouseup",function(a){var b=a||window.event,c=b.type,d=b.target||b.srcElement;switch(c){case"click":clickFilter()&&""===getSelectText()&&/HTML|BODY|FORM|SELECT|OPTION|TEEXTAREA|INPUT|AUDIO|CANVAS|VIDEO/.test(d.nodeName)===!1&&detectLevel(config.level,c,b);break;case"keyup":d.value&&detectLevel(config.level,c,b);break;case"change":/SELECT|TEEXTAREA|INPUT/.test(d.nodeName)===!0&&detectLevel(config.level,c,b);break;case"mouseup":""!==getSelectText()&&detectLevel(config.level,c,b)}send()}),getElePro.click=function(a){config.clickTime=timesamp();var b={},c=a.target||a.srcElement;if("LABEL"===c.nodeName){var d=c.children;if(1===d.length&&"INPUT"===d[0].nodeName)return{}}var e=trim(c.innerText||c.textContent||"");return b=fillEle(c,"click"),b.text=e.substr(0,30),b},getElePro.keyup=function(a){var b={},c=a.target||a.srcElement,d=root.userAction.record,e=d[d.length-1],f=c.value;if(e&&CompareEle(c,e)){var g=e.value,h=g[g.length-1];f.indexOf(h)>-1?g[g.length-1]=f:h.indexOf(f)==-1&&g.push(f)}else b=fillEle(c,"keyup",[f]),b.value=[f];return b},getElePro.change=function(a){var b={},c=a.target||a.srcElement,d=root.userAction.record,e=d[d.length-1],f=c.value;if("checkbox"==c.type&&(f=getCheckboxValues(c)),"select-multiple"==c.type&&(f=getSelectValues(c)),e&&"keyup"===e.eventType&&CompareEle(c,e)){var g=e.value;f!=g[g.length-1]&&g.push(f)}else b=fillEle(c,"keyup",[f]),b.value=[f];return b},getElePro.mouseup=function(a){var b={},c=a.target||a.srcElement;return b=fillEle(c,"select"),b.text=getSelectText(),b},domReady(doc,function(){var a=navType.indexOf("mobile")===-1?"beforeunload":"pagehide",b=root;"pagehide"===a&&(a=root.hasOwnProperty("onpagehide")?"pagehide":"beforeunload"),eventUtils.on(b,a,function(){psb.pub("visitTime")})}),root.onerror=function(a,b,c){userAction.scriptError.push({message:a,script:b,line:c}),10===userAction.scriptError.length&&(send(),userAction.scriptError.length=0)}}).call(this);