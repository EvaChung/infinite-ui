!function(){function t(t){var e=t?new Date(t):null;return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}function e(t){return t.parents("div.idate-calendar").hasClass("left")?0:1}function a(t,e,a){var n=+moment(e);return 2===this.rangeStatus&&this.startDate&&n>+moment(this.startDate)&&n<+moment(this.endDate)&&!a?" range-in":""}function n(t,e){return this.rangeStatus&&t===moment(this.startDate).format(f)&&!e?" from":""}function r(t,e){return 2!==this.rangeStatus||t!==moment(this.endDate).format(f)||e?"":" to"}function i(){var t=this,e=t.config.format,a=t.config.separator,n=t.startDate&&t.endDate?moment(t.startDate).format(e)+a+moment(t.endDate).format(e):"";t.$el.val(n).data("prevDate",n)}function o(){this.rangeStatus=0,this.startDate=null,this.endDate=null,this.rangeStep=0,this.$el.val("")}function d(){var e=this.$el[0],a=e.value?e.value.split(this.config.separator):[];return t(a[0])&&t(a[1])||(this.value="",a=[new Date,new Date]),a}function s(e){return e&&t(e[0])&&t(e[1])&&+new Date(e[0])<+new Date(e[1])}var l=function(t,e){for(var a,n=/<%([^%>]+)?%>/g,r=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,i="var r=[];\n",o=0,d=function(t,e){return i+=e?t.match(r)?t+"\n":"r.push("+t+");\n":""!==t?'r.push("'+t.replace(/"/g,'\\"')+'");\n':"",d};a=n.exec(t);)d(t.slice(o,a.index))(a[1],!0),o=a.index+a[0].length;return d(t.substr(o,t.length-o)),i+='return r.join("");',new Function(i.replace(/[\r\t\n]/g,"")).apply(e)},c='<%if(!this[\'idate\'].config.singleDatePicker){%><div class="range-time-show"><i class="fa fa-calendar glyphicon glyphicon-calendar"></i><span class="time-text"><%if(this[\'witchCalendar\'] === 0){%><%this[\'idate\'].startDate%><%}else{%><%this[\'idate\'].endDate%><%}%></span></div><%}%><table class="idate-table-condensed"><thead><tr><th class="btn-prev" data-num="<%this[\'prev\']%>"><i class="fa fa-chevron-left glyphicon glyphicon-chevron-left"></i></th><%this["title"]%><th class="btn-next" data-num="<%this[\'next\']%>"><i class="fa fa-chevron-left glyphicon glyphicon-chevron-right"></i></th></tr><%if(this["weeklist"]){%><tr class="idate-week"><%for(var i = 0;i < this["weeklist"].length ; i++){%><th><%this["weeklist"][i]%></th><%}%></tr><%}%></thead><%this["tbody"]%></table>',m='<div class="idate-container"><div class="idate-content clearfix"><div class="idate-calendar left"><div class="idate-calendar-table"></div></div>{{right-calendar}}{{sidebar}}</div></div>',h='<div class="idate-side"><button class="btn-shortcut" data-type="today">今天</button><button class="btn-shortcut" data-type="yesterday">昨天</button><button class="btn-shortcut" data-type="lastWeek">近七天</button><button class="btn-shortcut" data-type="lastMonth">近三十天</button><br><br><label class="calendar-type"><input name="idate-type" value="0" type="radio" checked>自定义</label><label class="calendar-type"><input name="idate-type" value="1" type="radio">自然周</label><label class="calendar-type"><input name="idate-type" value="2" type="radio">自然月</label></div>',u='<div class="idate-calendar right"><div class="idate-calendar-table"></div></div>',f="YYYY-MM-DD";$(window).on("resize",function(t){$(".idate-container.open").each(function(t,e){var a=$(e).data("idate");a.showCalendar(a.$el[0])})}),$("body").on("click",function(t){$(".idate-container.open").each(function(e,a){var n=$(t.target),r=$(a).data("idate");n.is(r.$el)||n.closest(".idate-container").length||n.is(r.$dateBox)||n.parents("table.idate-table-condensed").length||r.hideCalendar()})}),$.fn.IUI({idate:function(p){function v(t){this.$el=b,this.config=$.extend({},g,t);var e=!this.config.singleDatePicker;this.$container=$(this.config.container),this.template=m.replace("{{right-calendar}}",e?u:""),this.template=this.template.replace("{{sidebar}}",e&&this.config.sidebar?h:""),this.$dateBox=$(this.template),this.$dateTableContext=this.$dateBox.find(".idate-calendar-table"),this._cache=null,this.startDate=null,this.endDate=null,this.piking=null,this.checkType=0,this.rangeStep=0,this.rangeStatus=0,this.init()}if(void 0===typeof moment)throw"can not found moment.js";var b=this,g={container:"body",format:f,singleDatePicker:!1,separator:" to ",minDate:"",maxDate:"",maxDateLength:Number.MAX_VALUE,sidebar:!0,shortcut:{today:[moment(),moment()],yesterday:[moment().subtract(1,"d"),moment().subtract(1,"d")],lastWeek:[moment().subtract(6,"d"),moment()],lastMonth:[moment().subtract(29,"d"),moment()]}};return v.prototype.init=function(){var t=this,e=["singleEvent","rangeEvent"][t.config.singleDatePicker?0:1];t[e](),t.$dateBox.data("idate",t)},v.prototype.rangeEvent=function(){var t=this;t.$el.on("focus.iui-idate",function(e){var a,n=d.call(t);t._cache&&this.value===$(this).data("prevDate")?(t.$dateBox.html(t._cache),t.$dateTableContext=t.$dateBox.find(".idate-calendar-table"),t.$dateBox.find(".idate-content")):(a=t.renderRangeDates(n,n.slice()),t.$dateTableContext.each(function(t,e){e.innerHTML=a[t]})),t.$dateBox.find(".idate-calendar-table").removeClass("disabled"),t.showCalendar(this)}),t.$dateBox.on("click.iui-idate",".btn-prev,.btn-next",function(a){var n,r=$(this),i=e(r),o=r.data("num"),s=moment(o).subtract(1,"M").format(f),l=moment(o).add(1,"M").format(f),c=i?[s,o]:[o,l];n=0===t.mode?t.renderRangeDates(c,d.call(t)):1===t.mode?t.renderMonths(r.data("num")):t.renderYears(r.data("num")),"string"==typeof n?t.$dateTableContext.eq(i).html(n):t.$dateTableContext.each(function(t,e){e.innerHTML=n[t]})}),t.$dateBox.on("click.iui-idate","td.date",function(a){var n,r,o=$(this),d=o.data("num"),s=moment(t.startDate),l=moment(d),c=l.diff(s,"days")+1,m=e(o);if(1===t.checkType)t.startDate=moment(d).weekday(0).format(f),t.endDate=moment(d).weekday(6).format(f),t.rangeStatus=2,n=m?moment(t.startDate).subtract(1,"M"):t.startDate,r=t.renderRangeDates([n,null]),t.$dateTableContext.each(function(t,e){e.innerHTML=r[t]}),i.call(t),t.hideCalendar();else{if(o.hasClass("off")||c>t.config.maxDateLength&&1===t.rangeStatus)return;t.rangePicker(d,this)}}),t.$dateBox.on("mouseenter","td",function(e){var a,n=$(this),r=t.$dateBox.find("td"),i=r.index(n),o=r.index(t.$dateBox.find('td[data-num="'+t.startDate+'"]')),d=+new Date(t.startDate),s=moment(t.startDate);o===-1&&+new Date(r.eq(0).data("num"))>d&&(o=0),a=r.slice(o,i),t.rangeStep&&(r.slice(i).removeClass("range-in"),$.each(a,function(e,a){var n=$(a),r=n.data("num"),i=+new Date(r),o=moment(r).diff(s,"days");i>d&&!n.hasClass("off")&&o<t.config.maxDateLength&&n.addClass("range-in")}))}),t.$dateBox.on("click.iui-idate",".btn-month",function(a){var n=$(this),r=e(n),i=t.renderMonths($(this).data("num"));t.$dateTableContext.eq(r).html(i),t.$dateBox.find(".idate-calendar-table").eq(r?0:1).addClass("disabled")}),t.$dateBox.on("click.iui-idate",".btn-year",function(a){var n=$(this),r=e(n),i=t.renderYears($(this).data("num"));t.$dateTableContext.eq(r).html(i),t.$dateBox.find(".idate-calendar-table").eq(r?0:1).addClass("disabled")}),t.$dateBox.on("click.iui-idate","span.month",function(a){var n=$(this),r=e(n),o=$(this).data("num");if(2===t.checkType)t.startDate=moment(o).startOf("month").format(f),t.endDate=moment(o).endOf("month").format(f),t.rangeStatus=2,i.call(t),t.$dateBox.find(".time-text").eq(0).text(t.startDate),t.hideCalendar();else{var d=r?moment(o).subtract(1,"M"):o,s=t.renderRangeDates([d,null],!1);t.$dateBox.find(".idate-calendar-table").removeClass("disabled"),t.$dateTableContext.each(function(t,e){e.innerHTML=s[t]})}}),t.$dateBox.on("click.iui-idate","span.year",function(a){var n=$(this),r=e(n),i=t.renderMonths(n.data("num"));t.$dateTableContext.eq(r).html(i)}),t.$dateBox.on("click.iui-idate",".btn-shortcut",function(e){e.preventDefault();var a=$(this),n=t.config.shortcut[a.data("type")],r=n[0],o=n[1],d="mode-week mode-month";t.startDate=r.format(f),t.endDate=o.format(f),t.rangeStatus=2;var s=t.renderRangeDates([t.startDate,null]);t.$dateTableContext.each(function(t,e){e.innerHTML=s[t]}),a.addClass("active").siblings(".active").removeClass("active"),i.call(t),t.$dateBox.find(".idate-content").removeClass(d),t.$dateBox.find('[name="idate-type"]').removeAttr("checked").eq(0).attr("checked","checked"),t.hideCalendar()}),t.$dateBox.on("change.iui-idate",".calendar-type input",function(e){var a=$(this),n=t.checkType=parseInt(a.val(),10),r="mode-week mode-month",i=t.$dateBox.find(".idate-content"),o=t.$dateBox.find(".btn-shortcut"),d=t.$dateBox.find('[name="idate-type"]'),s=[moment(),null],l=t.renderRangeDates(s,!1),c={1:"mode-week",2:"mode-month"};o.removeClass("active"),d.not(a).removeAttr("checked"),a.attr("checked","checked"),t.$dateTableContext.each(function(t,e){e.innerHTML=l[t]}),n?(i.removeClass(r).addClass(c[n]),t.$dateBox.find(".idate-calendar-table").removeClass("disabled"),2===n&&t.$dateTableContext.eq(0).html(t.renderMonths(moment()))):i.removeClass(r),t.showCalendar(t.$el[0])})},v.prototype.singleEvent=function(){var e=this;e.$el.on("focus.iui-idate",function(a){var n=t(this.value)?this.value:+new Date,r=e.renderDates(n,this.value);e.$dateTableContext.html(r),e.showCalendar(this)}),e.$dateBox.on("click.iui-idate",".btn-prev,.btn-next",function(t){var a=$(this),n=a.data("num"),r=e.mode,i=r?1===r?e.renderMonths(n):e.renderYears(n):e.renderDates(n,e.$el.val());e.$dateTableContext.html(i)}),e.$dateBox.on("click.iui-idate",".btn-month,.btn-year",function(t){var a=$(this),n=a.data("num"),r=["renderMonths","renderYears"][a.hasClass("btn-month")?0:1],i=e[r](n);e.$dateTableContext.html(i)}),e.$dateBox.on("click.iui-idate","td.date",function(t){var a=$(this);e.singlePicker(a.data("num"))}),e.$dateBox.on("click.iui-idate","span.month,span.year",function(t){var a=$(this),n=(a.data("num"),["renderDates","renderMonths"][a.hasClass("month")?0:1]),r=e[n](a.data("num"),e.$el.val());e.$dateTableContext.html(r)})},v.prototype.showCalendar=function(t){var e,a=this,n=t.getBoundingClientRect(),r=n.left,i=n.top,o=n.width,d=n.height;a.$dateBox.removeAttr("style").addClass("open").css("opacity",0).appendTo(a.$container),e=a.$dateBox.outerWidth(),a.$dateBox.css({left:r+o-e,top:i+d+10,opacity:1})},v.prototype.hideCalendar=function(t){var e=this;1!==e.rangeStatus&&s(d.call(e))||o.call(e),e.config.singleDatePicker||2===e.rangeStatus||i.call(e),e.$dateBox.removeClass("open"),e._cache=0!==e.rangeStatus&&void 0!==e.mode?e.$dateBox.html():null},v.prototype.renderDates=function(e,i,o){var d=this,s=moment(e),m=s.format("M"),h=s.format(f),u=moment(e).date(1).weekday(0),p=moment().format(f),v=moment(t(i)?i:e),b=v.format(f),$=d.config.singleDatePicker,g=l(c,{witchCalendar:o,idate:d,title:'<th colspan="3" class="btn-month" data-num="'+h+'">'+s.format("MMMM")+'</th><th colspan="2" class="btn-year" data-num="'+h+'">'+s.format("YYYY")+"</th>",prev:moment(e).subtract(1,"M").format(f),next:moment(e).add(1,"M").format(f),weeklist:function(){for(var t=[],e=1;e<8;e++)t.push(s.isoWeekday(e).format("dd"));return t}(),tbody:function(){for(var t='<tbody class="idate-dateList"><tr>',e=1;e<43;e++){var o=u.add(1===e?0:1,"days"),s=o.format(f),l=o.format("M")===m,c=l?"":" off",h=s===p?" cur-date":"",v=$&&i&&s===b?" active":"",g=a.call(d,e,s,c),y=n.call(d,s,c),x=r.call(d,s,c),D=c+h+v+g+y+x;t+='<td class="date'+D+'" data-num="'+s+'">'+o.format("D")+"</td>",1!=e&&e%7===0&&(t+="</tr><tr>")}return t+"</tr></tbody>"}()});return d.mode=0,g},v.prototype.renderRangeDates=function(e,a){var n,r,i=this,o=t(e[0]),d=o?e[0]:moment(),l=moment(o?e[0]:+new Date).add(1,"M");return s(a)&&(i.rangeStatus=2,i.startDate=moment(+new Date(a[0])).format(f),i.endDate=moment(+new Date(a[1])).format(f)),n=i.renderDates(d,!1,0),r=i.renderDates(l,!1,1),[n,r]},v.prototype.renderMonths=function(t){var e=this,a=moment(t),n=a.format("YYYY"),r=parseInt(a.format("M"),10)-1,i=moment(),o=i.format("YYYY"),d=l(c,{idate:e,title:'<th colspan="5" class="btn-year" data-num="'+a.format(f)+'">'+n+"</th>",prev:moment(t).subtract(1,"y").format(f),next:moment(t).add(1,"y").format(f),tbody:function(){for(var t=moment.monthsShort(),e='<tbody class="idate-monthList"><tr><td colspan="7">',i=0;i<t.length;i++)e+='<span class="month'+(i===r&&n===o?" cur-month":"")+'" data-num="'+a.month(i).format(f)+'">'+t[i]+"</span>";return e+"</td></tr></tbody>"}()});return e.mode=1,d},v.prototype.renderYears=function(t){var e=this,a=moment(t).subtract(5,"y"),n=moment(t).add(6,"y"),r=parseInt(a.format("YYYY"),10),i=moment().format("YYYY"),o=l(c,{idate:e,title:'<th colspan="5" data-num="'+a.format(f)+'">'+r+"-"+n.format("YYYY")+"</th>",prev:moment(t).subtract(12,"y").format(f),next:moment(t).add(12,"y").format(f),tbody:function(){for(var t='<tbody class="idate-yearList"><tr><td colspan="7">',e=0;e<12;e++){var n=parseInt(i,10)===parseInt(r,10)+e?" cur-year":"",o=r+e,d=a.add(0===e?0:1,"y").format(f);t+='<span class="year'+n+'" data-num="'+d+'">'+o+"</span>"}return t+"</td></tr></tbody>"}()});return e.mode=2,o},v.prototype.singlePicker=function(t){var e=this;e.$el.val(moment(t).format(e.config.format)),e.hideCalendar()},v.prototype.rangePicker=function(t,e){var a=this,n=$(e),r=(moment(t),a.$dateBox.find("td")),o="range-in from to",d=a.$dateBox.find(".time-text"),s=d.eq(0),l=d.eq(1);a.$dateBox.find(".btn-shortcut").removeClass("active"),+new Date(t)<+new Date(a.startDate)&&(a.rangeStep=0,r.remove(o)),0===a.rangeStep?(r.removeClass(o),n.addClass("from"),a.rangeStep=1,a.startDate=t,a.rangeStatus=1,s.text(t)):(n.addClass("to"),a.rangeStep=0,a.endDate=t,a.rangeStatus=2,l.text(t),i.call(a),a.hideCalendar())},new v(p)}})}();